<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: lib/ExecutionEngine/JITLink/JITLinkMemoryManager.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LLVM
   &#160;<span id="projectnumber">13.0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_9ff4c6dc1720636682ab045c894e9bc5.html">ExecutionEngine</a></li><li class="navelem"><a class="el" href="dir_c0daa9c1887f9b9c5a8c0de610c5601a.html">JITLink</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">JITLinkMemoryManager.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="JITLinkMemoryManager_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===--- JITLinkMemoryManager.cpp - JITLinkMemoryManager implementation ---===//</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//                     The LLVM Compiler Infrastructure</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// This file is distributed under the University of Illinois Open Source</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// License. See LICENSE.TXT for details.</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160; </div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="JITLinkMemoryManager_8h.html">llvm/ExecutionEngine/JITLink/JITLinkMemoryManager.h</a>&quot;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Process_8h.html">llvm/Support/Process.h</a>&quot;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160; </div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacellvm.html">llvm</a> {</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="keyword">namespace </span>jitlink {</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160; </div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<a class="code" href="classllvm_1_1jitlink_1_1JITLinkMemoryManager.html#a92518ff41a3be01dac605d97d53581ca">JITLinkMemoryManager::~JITLinkMemoryManager</a>() = <span class="keywordflow">default</span>;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<a class="code" href="classllvm_1_1jitlink_1_1JITLinkMemoryManager_1_1Allocation.html#a7034d641045d83dbe611d0a01f4cbc22">JITLinkMemoryManager::Allocation::~Allocation</a>() = <span class="keywordflow">default</span>;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160; </div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;Expected&lt;std::unique_ptr&lt;JITLinkMemoryManager::Allocation&gt;&gt;</div>
<div class="line"><a name="l00020"></a><span class="lineno"><a class="line" href="classllvm_1_1jitlink_1_1InProcessMemoryManager.html#a4ac147452819eaa31f2f32a93c975e3e">   20</a></span>&#160;<a class="code" href="classllvm_1_1jitlink_1_1InProcessMemoryManager.html#a4ac147452819eaa31f2f32a93c975e3e">InProcessMemoryManager::allocate</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1jitlink_1_1JITLinkDylib.html">JITLinkDylib</a> *JD,</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;                                 <span class="keyword">const</span> <a class="code" href="classllvm_1_1DenseMap.html">SegmentsRequestMap</a> &amp;Request) {</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160; </div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  <span class="keyword">using</span> AllocationMap = <a class="code" href="classllvm_1_1DenseMap.html">DenseMap&lt;unsigned, sys::MemoryBlock&gt;</a>;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160; </div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  <span class="comment">// Local class for allocation.</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <span class="keyword">class </span>IPMMAlloc : <span class="keyword">public</span> <a class="code" href="classllvm_1_1jitlink_1_1JITLinkMemoryManager_1_1Allocation.html">Allocation</a> {</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <span class="keyword">public</span>:</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    IPMMAlloc(AllocationMap SegBlocks) : SegBlocks(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#ad3a99906764c35b2694ae90fa57744a5">std::move</a>(SegBlocks)) {}</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <a class="code" href="classllvm_1_1MutableArrayRef.html">MutableArrayRef&lt;char&gt;</a> getWorkingMemory(<a class="code" href="classllvm_1_1sys_1_1Memory.html#a548f317b89dc0bba738b89e5ce791395">ProtectionFlags</a> Seg)<span class="keyword"> override </span>{</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SegBlocks.count(Seg) &amp;&amp; <span class="stringliteral">&quot;No allocation for segment&quot;</span>);</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;      <span class="keywordflow">return</span> {<span class="keyword">static_cast&lt;</span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(SegBlocks[Seg].base()),</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;              SegBlocks[Seg].allocatedSize()};</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    }</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <a class="code" href="namespacellvm.html#a2b9aa96a24878fd7e3262812346c6c26">JITTargetAddress</a> getTargetMemory(<a class="code" href="classllvm_1_1sys_1_1Memory.html#a548f317b89dc0bba738b89e5ce791395">ProtectionFlags</a> Seg)<span class="keyword"> override </span>{</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SegBlocks.count(Seg) &amp;&amp; <span class="stringliteral">&quot;No allocation for segment&quot;</span>);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#ad45784477eeb166c43e4fba106ef5d2c">pointerToJITTargetAddress</a>(SegBlocks[Seg].<a class="code" href="lib_2Target_2SystemZ_2README_8txt.html#aff41f78457c5b0beb8af78edab100d70">base</a>());</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    }</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="keywordtype">void</span> finalizeAsync(FinalizeContinuation OnFinalize)<span class="keyword"> override </span>{</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;      OnFinalize(applyProtections());</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    }</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <a class="code" href="classllvm_1_1Error.html">Error</a> deallocate()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;      <span class="keywordflow">if</span> (SegBlocks.empty())</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1Error.html#a4dfd0813c3d0e0a30439b5a3e9196b59">Error::success</a>();</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;      <span class="keywordtype">void</span> *SlabStart = SegBlocks.begin()-&gt;second.base();</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;      <span class="keywordtype">char</span> *SlabEnd = (<span class="keywordtype">char</span> *)SlabStart;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;KV : SegBlocks) {</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        SlabStart = <a class="code" href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">std::min</a>(SlabStart, KV.second.base());</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        SlabEnd = <a class="code" href="namespacellvm.html#a81b52e18d84e3cc61df7e897bba1b259">std::max</a>(SlabEnd, (<span class="keywordtype">char</span> *)(KV.second.base()) +</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                                        KV.second.allocatedSize());</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;      }</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;      <span class="keywordtype">size_t</span> SlabSize = SlabEnd - (<span class="keywordtype">char</span> *)SlabStart;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;      <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((SlabSize % <a class="code" href="classllvm_1_1sys_1_1Process.html#a774becf3d10728695b270703bca011ec">sys::Process::getPageSizeEstimate</a>()) == 0 &amp;&amp;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;             <span class="stringliteral">&quot;Slab size is not a multiple of page size&quot;</span>);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      <a class="code" href="classllvm_1_1sys_1_1MemoryBlock.html">sys::MemoryBlock</a> Slab(SlabStart, SlabSize);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      <span class="keywordflow">if</span> (<span class="keyword">auto</span> EC = <a class="code" href="classllvm_1_1sys_1_1Memory.html#a042d24349a4b6a5ce475309cce529ae0">sys::Memory::releaseMappedMemory</a>(Slab))</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#ad10875fd499e8e285aaeef615e9b11aa">errorCodeToError</a>(EC);</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1Error.html#a4dfd0813c3d0e0a30439b5a3e9196b59">Error::success</a>();</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    }</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="keyword">private</span>:</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <a class="code" href="classllvm_1_1Error.html">Error</a> applyProtections() {</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;KV : SegBlocks) {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        <span class="keyword">auto</span> &amp;Prot = KV.first;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <span class="keyword">auto</span> &amp;<a class="code" href="classllvm_1_1jitlink_1_1Block.html">Block</a> = KV.second;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">auto</span> EC = <a class="code" href="classllvm_1_1sys_1_1Memory.html#ae27409ddee7e191f33392283ca826703">sys::Memory::protectMappedMemory</a>(<a class="code" href="classllvm_1_1jitlink_1_1Block.html">Block</a>, Prot))</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#ad10875fd499e8e285aaeef615e9b11aa">errorCodeToError</a>(EC);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <span class="keywordflow">if</span> (Prot &amp; <a class="code" href="classllvm_1_1sys_1_1Memory.html#a548f317b89dc0bba738b89e5ce791395a72200d7026f0978efe86fc34f4cba76e">sys::Memory::MF_EXEC</a>)</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;          <a class="code" href="classllvm_1_1sys_1_1Memory.html#a5cfd4d2a8227a3f9ca0667f42f05f20b">sys::Memory::InvalidateInstructionCache</a>(<a class="code" href="classllvm_1_1jitlink_1_1Block.html">Block</a>.base(),</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                                                  <a class="code" href="classllvm_1_1jitlink_1_1Block.html">Block</a>.allocatedSize());</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;      }</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="classllvm_1_1Error.html#a4dfd0813c3d0e0a30439b5a3e9196b59">Error::success</a>();</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    }</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160; </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    AllocationMap SegBlocks;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  };</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160; </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="namespacellvm.html#a434f6a0d80fb13e4326e848a6391f057">isPowerOf2_64</a>((uint64_t)<a class="code" href="classllvm_1_1sys_1_1Process.html#a774becf3d10728695b270703bca011ec">sys::Process::getPageSizeEstimate</a>()))</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">return</span> make_error&lt;StringError&gt;(<span class="stringliteral">&quot;Page size is not a power of 2&quot;</span>,</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                                   <a class="code" href="namespacellvm.html#a2b43c21951d0948b34bcf7019949032d">inconvertibleErrorCode</a>());</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160; </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  AllocationMap Blocks;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="keyword">const</span> <a class="code" href="classllvm_1_1sys_1_1Memory.html#a548f317b89dc0bba738b89e5ce791395">sys::Memory::ProtectionFlags</a> ReadWrite =</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      <span class="keyword">static_cast&lt;</span><a class="code" href="classllvm_1_1sys_1_1Memory.html#a548f317b89dc0bba738b89e5ce791395">sys::Memory::ProtectionFlags</a><span class="keyword">&gt;</span>(<a class="code" href="classllvm_1_1sys_1_1Memory.html#a548f317b89dc0bba738b89e5ce791395a02cae455b05abf1bfb1de69095e66417">sys::Memory::MF_READ</a> |</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                                                <a class="code" href="classllvm_1_1sys_1_1Memory.html#a548f317b89dc0bba738b89e5ce791395a83e34a8267f7acd88563e9d5a3ee7c25">sys::Memory::MF_WRITE</a>);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="comment">// Compute the total number of pages to allocate.</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keywordtype">size_t</span> TotalSize = 0;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;KV : Request) {</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> &amp;Seg = KV.second;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordflow">if</span> (Seg.getAlignment() &gt; <a class="code" href="classllvm_1_1sys_1_1Process.html#a774becf3d10728695b270703bca011ec">sys::Process::getPageSizeEstimate</a>())</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      <span class="keywordflow">return</span> make_error&lt;StringError&gt;(<span class="stringliteral">&quot;Cannot request higher than page &quot;</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                                     <span class="stringliteral">&quot;alignment&quot;</span>,</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                                     <a class="code" href="namespacellvm.html#a2b43c21951d0948b34bcf7019949032d">inconvertibleErrorCode</a>());</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160; </div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    TotalSize = <a class="code" href="namespacellvm.html#ab102f0f12dd38aeea5906b1d80c792ff">alignTo</a>(TotalSize, <a class="code" href="classllvm_1_1sys_1_1Process.html#a774becf3d10728695b270703bca011ec">sys::Process::getPageSizeEstimate</a>());</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    TotalSize += Seg.getContentSize();</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    TotalSize += Seg.getZeroFillSize();</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  }</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160; </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="comment">// Allocate one slab to cover all the segments.</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  std::error_code EC;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  <span class="keyword">auto</span> SlabRemaining =</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      <a class="code" href="classllvm_1_1sys_1_1Memory.html#a1326dd13b23711e68ade413fbc57b9f6">sys::Memory::allocateMappedMemory</a>(TotalSize, <span class="keyword">nullptr</span>, ReadWrite, EC);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160; </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="keywordflow">if</span> (EC)</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacellvm.html#ad10875fd499e8e285aaeef615e9b11aa">errorCodeToError</a>(EC);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160; </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <span class="comment">// Allocate segment memory from the slab.</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;KV : Request) {</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160; </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> &amp;Seg = KV.second;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160; </div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    uint64_t SegmentSize = <a class="code" href="namespacellvm.html#ab102f0f12dd38aeea5906b1d80c792ff">alignTo</a>(Seg.getContentSize() + Seg.getZeroFillSize(),</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                                   <a class="code" href="classllvm_1_1sys_1_1Process.html#a774becf3d10728695b270703bca011ec">sys::Process::getPageSizeEstimate</a>());</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <a class="code" href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SlabRemaining.allocatedSize() &gt;= SegmentSize &amp;&amp;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;           <span class="stringliteral">&quot;Mapping exceeds allocation&quot;</span>);</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160; </div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <a class="code" href="classllvm_1_1sys_1_1MemoryBlock.html">sys::MemoryBlock</a> SegMem(SlabRemaining.base(), SegmentSize);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    SlabRemaining = <a class="code" href="classllvm_1_1sys_1_1MemoryBlock.html">sys::MemoryBlock</a>((<span class="keywordtype">char</span> *)SlabRemaining.base() + SegmentSize,</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                                     SlabRemaining.allocatedSize() - SegmentSize);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160; </div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="comment">// Zero out the zero-fill memory.</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    memset(<span class="keyword">static_cast&lt;</span><span class="keywordtype">char</span> *<span class="keyword">&gt;</span>(SegMem.<a class="code" href="classllvm_1_1sys_1_1MemoryBlock.html#a4b2280fa9aed8be8dfc370f2a45fde84">base</a>()) + Seg.getContentSize(), 0,</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;           Seg.getZeroFillSize());</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160; </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="comment">// Record the block for this segment.</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    Blocks[KV.first] = <a class="code" href="lib_2Target_2ARM_2README_8txt.html#ad3a99906764c35b2694ae90fa57744a5">std::move</a>(SegMem);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  }</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160; </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="keywordflow">return</span> std::unique_ptr&lt;InProcessMemoryManager::Allocation&gt;(</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      <span class="keyword">new</span> IPMMAlloc(<a class="code" href="lib_2Target_2ARM_2README_8txt.html#ad3a99906764c35b2694ae90fa57744a5">std::move</a>(Blocks)));</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;}</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160; </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;} <span class="comment">// end namespace jitlink</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;} <span class="comment">// end namespace llvm</span></div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="anamespacellvm_html_ab102f0f12dd38aeea5906b1d80c792ff"><div class="ttname"><a href="namespacellvm.html#ab102f0f12dd38aeea5906b1d80c792ff">llvm::alignTo</a></div><div class="ttdeci">uint64_t alignTo(uint64_t Size, Align A)</div><div class="ttdoc">Returns a multiple of A needed to store Size bytes.</div><div class="ttdef"><b>Definition:</b> <a href="Alignment_8h_source.html#l00148">Alignment.h:148</a></div></div>
<div class="ttc" id="aclassllvm_1_1sys_1_1Memory_html_a548f317b89dc0bba738b89e5ce791395a02cae455b05abf1bfb1de69095e66417"><div class="ttname"><a href="classllvm_1_1sys_1_1Memory.html#a548f317b89dc0bba738b89e5ce791395a02cae455b05abf1bfb1de69095e66417">llvm::sys::Memory::MF_READ</a></div><div class="ttdeci">@ MF_READ</div><div class="ttdef"><b>Definition:</b> <a href="Memory_8h_source.html#l00055">Memory.h:55</a></div></div>
<div class="ttc" id="anamespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">---------------------— PointerInfo ------------------------------------—</div><div class="ttdef"><b>Definition:</b> <a href="AllocatorList_8h_source.html#l00023">AllocatorList.h:23</a></div></div>
<div class="ttc" id="aclassllvm_1_1sys_1_1Memory_html_a548f317b89dc0bba738b89e5ce791395a83e34a8267f7acd88563e9d5a3ee7c25"><div class="ttname"><a href="classllvm_1_1sys_1_1Memory.html#a548f317b89dc0bba738b89e5ce791395a83e34a8267f7acd88563e9d5a3ee7c25">llvm::sys::Memory::MF_WRITE</a></div><div class="ttdeci">@ MF_WRITE</div><div class="ttdef"><b>Definition:</b> <a href="Memory_8h_source.html#l00056">Memory.h:56</a></div></div>
<div class="ttc" id="aclassllvm_1_1sys_1_1Memory_html_a5cfd4d2a8227a3f9ca0667f42f05f20b"><div class="ttname"><a href="classllvm_1_1sys_1_1Memory.html#a5cfd4d2a8227a3f9ca0667f42f05f20b">llvm::sys::Memory::InvalidateInstructionCache</a></div><div class="ttdeci">static void InvalidateInstructionCache(const void *Addr, size_t Len)</div><div class="ttdoc">InvalidateInstructionCache - Before the JIT can run a block of code that has been emitted it must inv...</div></div>
<div class="ttc" id="aclassllvm_1_1Error_html_a4dfd0813c3d0e0a30439b5a3e9196b59"><div class="ttname"><a href="classllvm_1_1Error.html#a4dfd0813c3d0e0a30439b5a3e9196b59">llvm::Error::success</a></div><div class="ttdeci">static ErrorSuccess success()</div><div class="ttdoc">Create a success value.</div><div class="ttdef"><b>Definition:</b> <a href="llvm_2Support_2Error_8h_source.html#l00332">Error.h:332</a></div></div>
<div class="ttc" id="aclassllvm_1_1sys_1_1Memory_html_a1326dd13b23711e68ade413fbc57b9f6"><div class="ttname"><a href="classllvm_1_1sys_1_1Memory.html#a1326dd13b23711e68ade413fbc57b9f6">llvm::sys::Memory::allocateMappedMemory</a></div><div class="ttdeci">static MemoryBlock allocateMappedMemory(size_t NumBytes, const MemoryBlock *const NearBlock, unsigned Flags, std::error_code &amp;EC)</div><div class="ttdoc">This method allocates a block of memory that is suitable for loading dynamically generated code (e....</div></div>
<div class="ttc" id="aclassllvm_1_1sys_1_1Memory_html_a042d24349a4b6a5ce475309cce529ae0"><div class="ttname"><a href="classllvm_1_1sys_1_1Memory.html#a042d24349a4b6a5ce475309cce529ae0">llvm::sys::Memory::releaseMappedMemory</a></div><div class="ttdeci">static std::error_code releaseMappedMemory(MemoryBlock &amp;Block)</div><div class="ttdoc">This method releases a block of memory that was allocated with the allocateMappedMemory method.</div></div>
<div class="ttc" id="aclassllvm_1_1jitlink_1_1Block_html"><div class="ttname"><a href="classllvm_1_1jitlink_1_1Block.html">llvm::jitlink::Block</a></div><div class="ttdoc">An Addressable with content and edges.</div><div class="ttdef"><b>Definition:</b> <a href="JITLink_8h_source.html#l00150">JITLink.h:150</a></div></div>
<div class="ttc" id="aclassllvm_1_1sys_1_1MemoryBlock_html"><div class="ttname"><a href="classllvm_1_1sys_1_1MemoryBlock.html">llvm::sys::MemoryBlock</a></div><div class="ttdoc">This class encapsulates the notion of a memory block which has an address and a size.</div><div class="ttdef"><b>Definition:</b> <a href="Memory_8h_source.html#l00031">Memory.h:31</a></div></div>
<div class="ttc" id="aclassllvm_1_1jitlink_1_1JITLinkMemoryManager_html_a92518ff41a3be01dac605d97d53581ca"><div class="ttname"><a href="classllvm_1_1jitlink_1_1JITLinkMemoryManager.html#a92518ff41a3be01dac605d97d53581ca">llvm::jitlink::JITLinkMemoryManager::~JITLinkMemoryManager</a></div><div class="ttdeci">virtual ~JITLinkMemoryManager()</div></div>
<div class="ttc" id="aclassllvm_1_1jitlink_1_1InProcessMemoryManager_html_a4ac147452819eaa31f2f32a93c975e3e"><div class="ttname"><a href="classllvm_1_1jitlink_1_1InProcessMemoryManager.html#a4ac147452819eaa31f2f32a93c975e3e">llvm::jitlink::InProcessMemoryManager::allocate</a></div><div class="ttdeci">Expected&lt; std::unique_ptr&lt; Allocation &gt; &gt; allocate(const JITLinkDylib *JD, const SegmentsRequestMap &amp;Request) override</div><div class="ttdoc">Create an Allocation object.</div><div class="ttdef"><b>Definition:</b> <a href="JITLinkMemoryManager_8cpp_source.html#l00020">JITLinkMemoryManager.cpp:20</a></div></div>
<div class="ttc" id="aclassllvm_1_1jitlink_1_1JITLinkMemoryManager_1_1Allocation_html"><div class="ttname"><a href="classllvm_1_1jitlink_1_1JITLinkMemoryManager_1_1Allocation.html">llvm::jitlink::JITLinkMemoryManager::Allocation</a></div><div class="ttdoc">Represents an allocation created by the memory manager.</div><div class="ttdef"><b>Definition:</b> <a href="JITLinkMemoryManager_8h_source.html#l00063">JITLinkMemoryManager.h:63</a></div></div>
<div class="ttc" id="aProcess_8h_html"><div class="ttname"><a href="Process_8h.html">Process.h</a></div><div class="ttdoc">Provides a library for accessing information about this process and other processes on the operating ...</div></div>
<div class="ttc" id="aclassllvm_1_1MutableArrayRef_html"><div class="ttname"><a href="classllvm_1_1MutableArrayRef.html">llvm::MutableArrayRef</a></div><div class="ttdoc">MutableArrayRef - Represent a mutable reference to an array (0 or more elements consecutively in memo...</div><div class="ttdef"><b>Definition:</b> <a href="ArrayRef_8h_source.html#l00307">ArrayRef.h:307</a></div></div>
<div class="ttc" id="anamespacellvm_html_ad10875fd499e8e285aaeef615e9b11aa"><div class="ttname"><a href="namespacellvm.html#ad10875fd499e8e285aaeef615e9b11aa">llvm::errorCodeToError</a></div><div class="ttdeci">Error errorCodeToError(std::error_code EC)</div><div class="ttdoc">Helper for converting an std::error_code to a Error.</div><div class="ttdef"><b>Definition:</b> <a href="Testing_2Support_2Error_8cpp_source.html#l00087">Error.cpp:87</a></div></div>
<div class="ttc" id="aclassllvm_1_1sys_1_1Memory_html_a548f317b89dc0bba738b89e5ce791395"><div class="ttname"><a href="classllvm_1_1sys_1_1Memory.html#a548f317b89dc0bba738b89e5ce791395">llvm::sys::Memory::ProtectionFlags</a></div><div class="ttdeci">ProtectionFlags</div><div class="ttdef"><b>Definition:</b> <a href="Memory_8h_source.html#l00054">Memory.h:54</a></div></div>
<div class="ttc" id="aclassllvm_1_1sys_1_1MemoryBlock_html_a4b2280fa9aed8be8dfc370f2a45fde84"><div class="ttname"><a href="classllvm_1_1sys_1_1MemoryBlock.html#a4b2280fa9aed8be8dfc370f2a45fde84">llvm::sys::MemoryBlock::base</a></div><div class="ttdeci">void * base() const</div><div class="ttdef"><b>Definition:</b> <a href="Memory_8h_source.html#l00036">Memory.h:36</a></div></div>
<div class="ttc" id="aclassllvm_1_1jitlink_1_1JITLinkDylib_html"><div class="ttname"><a href="classllvm_1_1jitlink_1_1JITLinkDylib.html">llvm::jitlink::JITLinkDylib</a></div><div class="ttdef"><b>Definition:</b> <a href="JITLinkDylib_8h_source.html#l00019">JITLinkDylib.h:19</a></div></div>
<div class="ttc" id="aclassllvm_1_1sys_1_1Memory_html_a548f317b89dc0bba738b89e5ce791395a72200d7026f0978efe86fc34f4cba76e"><div class="ttname"><a href="classllvm_1_1sys_1_1Memory.html#a548f317b89dc0bba738b89e5ce791395a72200d7026f0978efe86fc34f4cba76e">llvm::sys::Memory::MF_EXEC</a></div><div class="ttdeci">@ MF_EXEC</div><div class="ttdef"><b>Definition:</b> <a href="Memory_8h_source.html#l00057">Memory.h:57</a></div></div>
<div class="ttc" id="alib_2Target_2ARM_2README_8txt_html_ad3a99906764c35b2694ae90fa57744a5"><div class="ttname"><a href="lib_2Target_2ARM_2README_8txt.html#ad3a99906764c35b2694ae90fa57744a5">move</a></div><div class="ttdeci">compiles ldr LCPI1_0 ldr ldr mov lsr tst moveq r1 ldr LCPI1_1 and r0 bx lr It would be better to do something like to fold the shift into the conditional move</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2ARM_2README_8txt_source.html#l00544">README.txt:546</a></div></div>
<div class="ttc" id="aclassllvm_1_1DenseMap_html"><div class="ttname"><a href="classllvm_1_1DenseMap.html">llvm::DenseMap</a></div><div class="ttdef"><b>Definition:</b> <a href="DenseMap_8h_source.html#l00714">DenseMap.h:715</a></div></div>
<div class="ttc" id="aSILowerControlFlow_8cpp_html_a4868c5d81c5ccc98c47aeab6244346a0"><div class="ttname"><a href="SILowerControlFlow_8cpp.html#a4868c5d81c5ccc98c47aeab6244346a0">assert</a></div><div class="ttdeci">assert(ImpDefSCC.getReg()==AMDGPU::SCC &amp;&amp;ImpDefSCC.isDef())</div></div>
<div class="ttc" id="alib_2Target_2SystemZ_2README_8txt_html_aff41f78457c5b0beb8af78edab100d70"><div class="ttname"><a href="lib_2Target_2SystemZ_2README_8txt.html#aff41f78457c5b0beb8af78edab100d70">base</a></div><div class="ttdeci">therefore end up llgh r3 lr r0 br r14 but truncating the load would lh r3 br r14 Functions ret i64 and ought to be implemented ngr r0 br r14 but two address optimizations reverse the order of the AND and ngr r2 lgr r0 br r14 CodeGen SystemZ and ll has several examples of this Out of range displacements are usually handled by loading the full address into a register In many cases it would be better to create an anchor point instead E g i64 base</div><div class="ttdef"><b>Definition:</b> <a href="lib_2Target_2SystemZ_2README_8txt_source.html#l00125">README.txt:125</a></div></div>
<div class="ttc" id="anamespacellvm_html_a57f2ca0e57f4f7b13f56f9aa16af3e0d"><div class="ttname"><a href="namespacellvm.html#a57f2ca0e57f4f7b13f56f9aa16af3e0d">llvm::min</a></div><div class="ttdeci">Expected&lt; ExpressionValue &gt; min(const ExpressionValue &amp;Lhs, const ExpressionValue &amp;Rhs)</div><div class="ttdef"><b>Definition:</b> <a href="FileCheck_8cpp_source.html#l00357">FileCheck.cpp:357</a></div></div>
<div class="ttc" id="aJITLinkMemoryManager_8h_html"><div class="ttname"><a href="JITLinkMemoryManager_8h.html">JITLinkMemoryManager.h</a></div></div>
<div class="ttc" id="anamespacellvm_html_ad45784477eeb166c43e4fba106ef5d2c"><div class="ttname"><a href="namespacellvm.html#ad45784477eeb166c43e4fba106ef5d2c">llvm::pointerToJITTargetAddress</a></div><div class="ttdeci">JITTargetAddress pointerToJITTargetAddress(T *Ptr)</div><div class="ttdoc">Convert a pointer to a JITTargetAddress.</div><div class="ttdef"><b>Definition:</b> <a href="JITSymbol_8h_source.html#l00069">JITSymbol.h:69</a></div></div>
<div class="ttc" id="anamespacellvm_html_a2b43c21951d0948b34bcf7019949032d"><div class="ttname"><a href="namespacellvm.html#a2b43c21951d0948b34bcf7019949032d">llvm::inconvertibleErrorCode</a></div><div class="ttdeci">std::error_code inconvertibleErrorCode()</div><div class="ttdoc">The value returned by this function can be returned from convertToErrorCode for Error values where no...</div><div class="ttdef"><b>Definition:</b> <a href="Testing_2Support_2Error_8cpp_source.html#l00077">Error.cpp:77</a></div></div>
<div class="ttc" id="aclassllvm_1_1Error_html"><div class="ttname"><a href="classllvm_1_1Error.html">llvm::Error</a></div><div class="ttdoc">Lightweight error class with error context and mandatory checking.</div><div class="ttdef"><b>Definition:</b> <a href="llvm_2Support_2Error_8h_source.html#l00157">Error.h:157</a></div></div>
<div class="ttc" id="anamespacellvm_html_a2b9aa96a24878fd7e3262812346c6c26"><div class="ttname"><a href="namespacellvm.html#a2b9aa96a24878fd7e3262812346c6c26">llvm::JITTargetAddress</a></div><div class="ttdeci">uint64_t JITTargetAddress</div><div class="ttdoc">Represents an address in the target process's address space.</div><div class="ttdef"><b>Definition:</b> <a href="JITSymbol_8h_source.html#l00042">JITSymbol.h:42</a></div></div>
<div class="ttc" id="aclassllvm_1_1sys_1_1Memory_html_ae27409ddee7e191f33392283ca826703"><div class="ttname"><a href="classllvm_1_1sys_1_1Memory.html#ae27409ddee7e191f33392283ca826703">llvm::sys::Memory::protectMappedMemory</a></div><div class="ttdeci">static std::error_code protectMappedMemory(const MemoryBlock &amp;Block, unsigned Flags)</div><div class="ttdoc">This method sets the protection flags for a block of memory to the state specified by /p Flags.</div></div>
<div class="ttc" id="aclassllvm_1_1jitlink_1_1JITLinkMemoryManager_1_1Allocation_html_a7034d641045d83dbe611d0a01f4cbc22"><div class="ttname"><a href="classllvm_1_1jitlink_1_1JITLinkMemoryManager_1_1Allocation.html#a7034d641045d83dbe611d0a01f4cbc22">llvm::jitlink::JITLinkMemoryManager::Allocation::~Allocation</a></div><div class="ttdeci">virtual ~Allocation()</div></div>
<div class="ttc" id="anamespacellvm_html_a81b52e18d84e3cc61df7e897bba1b259"><div class="ttname"><a href="namespacellvm.html#a81b52e18d84e3cc61df7e897bba1b259">llvm::max</a></div><div class="ttdeci">Align max(MaybeAlign Lhs, Align Rhs)</div><div class="ttdef"><b>Definition:</b> <a href="Alignment_8h_source.html#l00340">Alignment.h:340</a></div></div>
<div class="ttc" id="aclassllvm_1_1sys_1_1Process_html_a774becf3d10728695b270703bca011ec"><div class="ttname"><a href="classllvm_1_1sys_1_1Process.html#a774becf3d10728695b270703bca011ec">llvm::sys::Process::getPageSizeEstimate</a></div><div class="ttdeci">static unsigned getPageSizeEstimate()</div><div class="ttdoc">Get the process's estimated page size.</div><div class="ttdef"><b>Definition:</b> <a href="Process_8h_source.html#l00062">Process.h:62</a></div></div>
<div class="ttc" id="anamespacellvm_html_a434f6a0d80fb13e4326e848a6391f057"><div class="ttname"><a href="namespacellvm.html#a434f6a0d80fb13e4326e848a6391f057">llvm::isPowerOf2_64</a></div><div class="ttdeci">constexpr bool isPowerOf2_64(uint64_t Value)</div><div class="ttdoc">Return true if the argument is a power of two &gt; 0 (64 bit edition.)</div><div class="ttdef"><b>Definition:</b> <a href="MathExtras_8h_source.html#l00496">MathExtras.h:496</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Feb 8 2022 04:36:39 for LLVM by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
