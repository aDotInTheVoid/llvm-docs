<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: lib/Support/DivisionByConstantInfo.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LLVM
   &#160;<span id="projectnumber">15.0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_f0dc79bace318df7ec0fa0bdb179ed95.html">Support</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">DivisionByConstantInfo.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="DivisionByConstantInfo_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//===----- DivisionByConstantInfo.cpp - division by constant -*- C++ -*----===//</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// See https://llvm.org/LICENSE.txt for license information.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//===----------------------------------------------------------------------===//</span><span class="comment"></span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">/// This file implements support for optimizing divisions by a constant</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">///</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"></span><span class="comment">//===----------------------------------------------------------------------===//</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160; </div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="DivisionByConstantInfo_8h.html">llvm/Support/DivisionByConstantInfo.h</a>&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160; </div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="keyword">using namespace </span><a class="code" href="namespacellvm.html">llvm</a>;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">/// Calculate the magic numbers required to implement a signed integer division</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">/// by a constant as a sequence of multiplies, adds and shifts.  Requires that</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">/// the divisor not be 0, 1, or -1.  Taken from &quot;Hacker&#39;s Delight&quot;, Henry S.</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">/// Warren, Jr., Chapter 10.</span></div>
<div class="line"><a name="l00021"></a><span class="lineno"><a class="line" href="structllvm_1_1SignedDivisionByConstantInfo.html#affa10b6ac03585fea6d8f1832071ebd5">   21</a></span>&#160;<span class="comment"></span><a class="code" href="structllvm_1_1SignedDivisionByConstantInfo.html">SignedDivisionByConstantInfo</a> <a class="code" href="structllvm_1_1SignedDivisionByConstantInfo.html#affa10b6ac03585fea6d8f1832071ebd5">SignedDivisionByConstantInfo::get</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;<a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>) {</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  <a class="code" href="classllvm_1_1APInt.html">APInt</a> AD, ANC, Delta, Q1, R1, Q2, <a class="code" href="MathExtras_8h.html#a9211f62d8e1e6de999eaa63ec0f6ae02">R2</a>, <a class="code" href="classT.html">T</a>;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  <a class="code" href="classllvm_1_1APInt.html">APInt</a> SignedMin = <a class="code" href="classllvm_1_1APInt.html#a8f877403433892e14ff0c692cbe9efdf">APInt::getSignedMinValue</a>(<a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>.getBitWidth());</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  <span class="keyword">struct </span><a class="code" href="structllvm_1_1SignedDivisionByConstantInfo.html">SignedDivisionByConstantInfo</a> Retval;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160; </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  AD = <a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>.abs();</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <a class="code" href="classT.html">T</a> = SignedMin + (<a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>.lshr(<a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>.getBitWidth() - 1));</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  ANC = <a class="code" href="classT.html">T</a> - 1 - <a class="code" href="classT.html">T</a>.urem(AD);  <span class="comment">// absolute value of NC</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> = <a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>.getBitWidth() - 1;   <span class="comment">// initialize P</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  Q1 = SignedMin.<a class="code" href="classllvm_1_1APInt.html#a05d674becc60ba4ef8cd4dd4d38ac27a">udiv</a>(ANC);  <span class="comment">// initialize Q1 = 2P/abs(NC)</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  R1 = SignedMin - Q1 * ANC; <span class="comment">// initialize R1 = rem(2P,abs(NC))</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  Q2 = SignedMin.<a class="code" href="classllvm_1_1APInt.html#a05d674becc60ba4ef8cd4dd4d38ac27a">udiv</a>(AD);   <span class="comment">// initialize Q2 = 2P/abs(D)</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <a class="code" href="MathExtras_8h.html#a9211f62d8e1e6de999eaa63ec0f6ae02">R2</a> = SignedMin - Q2 * AD;  <span class="comment">// initialize R2 = rem(2P,abs(D))</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> = <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> + 1;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    Q1 = Q1 &lt;&lt; 1;      <span class="comment">// update Q1 = 2P/abs(NC)</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    R1 = R1 &lt;&lt; 1;      <span class="comment">// update R1 = rem(2P/abs(NC))</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keywordflow">if</span> (R1.<a class="code" href="classllvm_1_1APInt.html#af4b1ccc0b78f9da9f3f3944e06007f1d">uge</a>(ANC)) { <span class="comment">// must be unsigned comparison</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;      Q1 = Q1 + 1;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;      R1 = R1 - ANC;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    }</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    Q2 = Q2 &lt;&lt; 1;     <span class="comment">// update Q2 = 2P/abs(D)</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <a class="code" href="MathExtras_8h.html#a9211f62d8e1e6de999eaa63ec0f6ae02">R2</a> = <a class="code" href="MathExtras_8h.html#a9211f62d8e1e6de999eaa63ec0f6ae02">R2</a> &lt;&lt; 1;     <span class="comment">// update R2 = rem(2P/abs(D))</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="MathExtras_8h.html#a9211f62d8e1e6de999eaa63ec0f6ae02">R2</a>.uge(AD)) { <span class="comment">// must be unsigned comparison</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;      Q2 = Q2 + 1;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;      <a class="code" href="MathExtras_8h.html#a9211f62d8e1e6de999eaa63ec0f6ae02">R2</a> = <a class="code" href="MathExtras_8h.html#a9211f62d8e1e6de999eaa63ec0f6ae02">R2</a> - AD;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    }</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    Delta = AD - <a class="code" href="MathExtras_8h.html#a9211f62d8e1e6de999eaa63ec0f6ae02">R2</a>;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  } <span class="keywordflow">while</span> (Q1.<a class="code" href="classllvm_1_1APInt.html#a545e8d5dfa1688acea0d0e275b03682f">ult</a>(Delta) || (Q1 == Delta &amp;&amp; R1 == 0));</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  Retval.<a class="code" href="structllvm_1_1SignedDivisionByConstantInfo.html#aa54b0543973a6ef974f769d0e9383850">Magic</a> = Q2 + 1;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>.isNegative())</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    Retval.<a class="code" href="structllvm_1_1SignedDivisionByConstantInfo.html#aa54b0543973a6ef974f769d0e9383850">Magic</a> = -Retval.<a class="code" href="structllvm_1_1SignedDivisionByConstantInfo.html#aa54b0543973a6ef974f769d0e9383850">Magic</a>;           <span class="comment">// resulting magic number</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  Retval.<a class="code" href="structllvm_1_1SignedDivisionByConstantInfo.html#a4cfbfc736687e2b99cd2cc6cd2d208c4">ShiftAmount</a> = <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> - <a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>.getBitWidth(); <span class="comment">// resulting shift</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="keywordflow">return</span> Retval;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;}</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">/// Calculate the magic numbers required to implement an unsigned integer</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">/// division by a constant as a sequence of multiplies, adds and shifts.</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">/// Requires that the divisor not be 0.  Taken from &quot;Hacker&#39;s Delight&quot;, Henry</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">/// S. Warren, Jr., chapter 10.</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">/// LeadingZeros can be used to simplify the calculation if the upper bits</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">/// of the divided value are known zero.</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment"></span><a class="code" href="structllvm_1_1UnsignedDivisionByConstantInfo.html">UnsignedDivisionByConstantInfo</a></div>
<div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="structllvm_1_1UnsignedDivisionByConstantInfo.html#a4e23d76b66d7fde7bb9c121dc7a0d611">   66</a></span>&#160;<a class="code" href="structllvm_1_1UnsignedDivisionByConstantInfo.html#a4e23d76b66d7fde7bb9c121dc7a0d611">UnsignedDivisionByConstantInfo::get</a>(<span class="keyword">const</span> <a class="code" href="classllvm_1_1APInt.html">APInt</a> &amp;<a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>, <span class="keywordtype">unsigned</span> LeadingZeros) {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keywordtype">unsigned</span> <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a>;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  <a class="code" href="classllvm_1_1APInt.html">APInt</a> <a class="code" href="regutils_8h.html#a1fa2460e32327ade49189c95740bc1b5">NC</a>, Delta, Q1, R1, Q2, <a class="code" href="MathExtras_8h.html#a9211f62d8e1e6de999eaa63ec0f6ae02">R2</a>;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="keyword">struct </span><a class="code" href="structllvm_1_1UnsignedDivisionByConstantInfo.html">UnsignedDivisionByConstantInfo</a> Retval;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  Retval.<a class="code" href="structllvm_1_1UnsignedDivisionByConstantInfo.html#a1b8b2eee90075caf0407679fb780f5c9">IsAdd</a> = <span class="keyword">false</span>; <span class="comment">// initialize &quot;add&quot; indicator</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <a class="code" href="classllvm_1_1APInt.html">APInt</a> AllOnes = <a class="code" href="classllvm_1_1APInt.html#a071e8d814b2b30b02544fad964227b8e">APInt::getAllOnes</a>(<a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>.getBitWidth()).<a class="code" href="classllvm_1_1APInt.html#af34549c39d6f741fbdaf9a795aa306e9">lshr</a>(LeadingZeros);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <a class="code" href="classllvm_1_1APInt.html">APInt</a> SignedMin = <a class="code" href="classllvm_1_1APInt.html#a8f877403433892e14ff0c692cbe9efdf">APInt::getSignedMinValue</a>(<a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>.getBitWidth());</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <a class="code" href="classllvm_1_1APInt.html">APInt</a> SignedMax = <a class="code" href="classllvm_1_1APInt.html#a562c9513409b74f02cb3a5c9bae672ea">APInt::getSignedMaxValue</a>(<a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>.getBitWidth());</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <a class="code" href="regutils_8h.html#a1fa2460e32327ade49189c95740bc1b5">NC</a> = AllOnes - (AllOnes - <a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>).urem(<a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> = <a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>.getBitWidth() - 1;  <span class="comment">// initialize P</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  Q1 = SignedMin.<a class="code" href="classllvm_1_1APInt.html#a05d674becc60ba4ef8cd4dd4d38ac27a">udiv</a>(<a class="code" href="regutils_8h.html#a1fa2460e32327ade49189c95740bc1b5">NC</a>);  <span class="comment">// initialize Q1 = 2P/NC</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  R1 = SignedMin - Q1 * <a class="code" href="regutils_8h.html#a1fa2460e32327ade49189c95740bc1b5">NC</a>; <span class="comment">// initialize R1 = rem(2P,NC)</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  Q2 = SignedMax.<a class="code" href="classllvm_1_1APInt.html#a05d674becc60ba4ef8cd4dd4d38ac27a">udiv</a>(<a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>);   <span class="comment">// initialize Q2 = (2P-1)/D</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <a class="code" href="MathExtras_8h.html#a9211f62d8e1e6de999eaa63ec0f6ae02">R2</a> = SignedMax - Q2 * <a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>;  <span class="comment">// initialize R2 = rem((2P-1),D)</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> = <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> + 1;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordflow">if</span> (R1.<a class="code" href="classllvm_1_1APInt.html#af4b1ccc0b78f9da9f3f3944e06007f1d">uge</a>(<a class="code" href="regutils_8h.html#a1fa2460e32327ade49189c95740bc1b5">NC</a> - R1)) {</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      Q1 = Q1 + Q1 + 1;  <span class="comment">// update Q1</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      R1 = R1 + R1 - <a class="code" href="regutils_8h.html#a1fa2460e32327ade49189c95740bc1b5">NC</a>; <span class="comment">// update R1</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      Q1 = Q1 + Q1; <span class="comment">// update Q1</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      R1 = R1 + R1; <span class="comment">// update R1</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    }</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordflow">if</span> ((<a class="code" href="MathExtras_8h.html#a9211f62d8e1e6de999eaa63ec0f6ae02">R2</a> + 1).uge(<a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a> - <a class="code" href="MathExtras_8h.html#a9211f62d8e1e6de999eaa63ec0f6ae02">R2</a>)) {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      <span class="keywordflow">if</span> (Q2.<a class="code" href="classllvm_1_1APInt.html#af4b1ccc0b78f9da9f3f3944e06007f1d">uge</a>(SignedMax))</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        Retval.<a class="code" href="structllvm_1_1UnsignedDivisionByConstantInfo.html#a1b8b2eee90075caf0407679fb780f5c9">IsAdd</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      Q2 = Q2 + Q2 + 1;     <span class="comment">// update Q2</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      <a class="code" href="MathExtras_8h.html#a9211f62d8e1e6de999eaa63ec0f6ae02">R2</a> = <a class="code" href="MathExtras_8h.html#a9211f62d8e1e6de999eaa63ec0f6ae02">R2</a> + <a class="code" href="MathExtras_8h.html#a9211f62d8e1e6de999eaa63ec0f6ae02">R2</a> + 1 - <a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>; <span class="comment">// update R2</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <span class="keywordflow">if</span> (Q2.<a class="code" href="classllvm_1_1APInt.html#af4b1ccc0b78f9da9f3f3944e06007f1d">uge</a>(SignedMin))</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        Retval.<a class="code" href="structllvm_1_1UnsignedDivisionByConstantInfo.html#a1b8b2eee90075caf0407679fb780f5c9">IsAdd</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      Q2 = Q2 + Q2;     <span class="comment">// update Q2</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      <a class="code" href="MathExtras_8h.html#a9211f62d8e1e6de999eaa63ec0f6ae02">R2</a> = <a class="code" href="MathExtras_8h.html#a9211f62d8e1e6de999eaa63ec0f6ae02">R2</a> + <a class="code" href="MathExtras_8h.html#a9211f62d8e1e6de999eaa63ec0f6ae02">R2</a> + 1; <span class="comment">// update R2</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    }</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    Delta = <a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a> - 1 - <a class="code" href="MathExtras_8h.html#a9211f62d8e1e6de999eaa63ec0f6ae02">R2</a>;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  } <span class="keywordflow">while</span> (<a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> &lt; <a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>.getBitWidth() * 2 &amp;&amp;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;           (Q1.<a class="code" href="classllvm_1_1APInt.html#a545e8d5dfa1688acea0d0e275b03682f">ult</a>(Delta) || (Q1 == Delta &amp;&amp; R1 == 0)));</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  Retval.<a class="code" href="structllvm_1_1UnsignedDivisionByConstantInfo.html#a890b63a18fc3e328809c691b17c776ed">Magic</a> = Q2 + 1;                    <span class="comment">// resulting magic number</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  Retval.<a class="code" href="structllvm_1_1UnsignedDivisionByConstantInfo.html#a505f562e64f576e9801f0549e190622a">ShiftAmount</a> = <a class="code" href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a> - <a class="code" href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a>.getBitWidth(); <span class="comment">// resulting shift</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  <span class="keywordflow">return</span> Retval;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="anamespacellvm_html"><div class="ttname"><a href="namespacellvm.html">llvm</a></div><div class="ttdoc">This is an optimization pass for GlobalISel generic memory operations.</div><div class="ttdef"><b>Definition:</b> <a href="AddressRanges_8h_source.html#l00018">AddressRanges.h:18</a></div></div>
<div class="ttc" id="aDivisionByConstantInfo_8h_html"><div class="ttname"><a href="DivisionByConstantInfo_8h.html">DivisionByConstantInfo.h</a></div></div>
<div class="ttc" id="aclassT_html"><div class="ttname"><a href="classT.html">T</a></div></div>
<div class="ttc" id="aREADME-SSE_8txt_html_a63d206a063eefcdf8c318ded97b65020"><div class="ttname"><a href="README-SSE_8txt.html#a63d206a063eefcdf8c318ded97b65020">P</a></div><div class="ttdeci">This currently compiles esp xmm0 movsd esp eax eax esp ret We should use not the dag combiner This is because dagcombine2 needs to be able to see through the X86ISD::Wrapper which DAGCombine can t really do The code for turning x load into a single vector load is target independent and should be moved to the dag combiner The code for turning x load into a vector load can only handle a direct load from a global or a direct load from the stack It should be generalized to handle any load from P</div><div class="ttdef"><b>Definition:</b> <a href="README-SSE_8txt_source.html#l00411">README-SSE.txt:411</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_a562c9513409b74f02cb3a5c9bae672ea"><div class="ttname"><a href="classllvm_1_1APInt.html#a562c9513409b74f02cb3a5c9bae672ea">llvm::APInt::getSignedMaxValue</a></div><div class="ttdeci">static APInt getSignedMaxValue(unsigned numBits)</div><div class="ttdoc">Gets maximum signed value of APInt for a specific bit width.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00189">APInt.h:189</a></div></div>
<div class="ttc" id="astructllvm_1_1UnsignedDivisionByConstantInfo_html_a4e23d76b66d7fde7bb9c121dc7a0d611"><div class="ttname"><a href="structllvm_1_1UnsignedDivisionByConstantInfo.html#a4e23d76b66d7fde7bb9c121dc7a0d611">llvm::UnsignedDivisionByConstantInfo::get</a></div><div class="ttdeci">static UnsignedDivisionByConstantInfo get(const APInt &amp;D, unsigned LeadingZeros=0)</div><div class="ttdoc">Calculate the magic numbers required to implement an unsigned integer division by a constant as a seq...</div><div class="ttdef"><b>Definition:</b> <a href="DivisionByConstantInfo_8cpp_source.html#l00066">DivisionByConstantInfo.cpp:66</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_af34549c39d6f741fbdaf9a795aa306e9"><div class="ttname"><a href="classllvm_1_1APInt.html#af34549c39d6f741fbdaf9a795aa306e9">llvm::APInt::lshr</a></div><div class="ttdeci">APInt lshr(unsigned shiftAmt) const</div><div class="ttdoc">Logical right-shift function.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00832">APInt.h:832</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_af4b1ccc0b78f9da9f3f3944e06007f1d"><div class="ttname"><a href="classllvm_1_1APInt.html#af4b1ccc0b78f9da9f3f3944e06007f1d">llvm::APInt::uge</a></div><div class="ttdeci">bool uge(const APInt &amp;RHS) const</div><div class="ttdoc">Unsigned greater or equal comparison.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01171">APInt.h:1171</a></div></div>
<div class="ttc" id="aMathExtras_8h_html_a9211f62d8e1e6de999eaa63ec0f6ae02"><div class="ttname"><a href="MathExtras_8h.html#a9211f62d8e1e6de999eaa63ec0f6ae02">R2</a></div><div class="ttdeci">#define R2(n)</div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_a071e8d814b2b30b02544fad964227b8e"><div class="ttname"><a href="classllvm_1_1APInt.html#a071e8d814b2b30b02544fad964227b8e">llvm::APInt::getAllOnes</a></div><div class="ttdeci">static APInt getAllOnes(unsigned numBits)</div><div class="ttdoc">Return an APInt of a specified width with all bits set.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00214">APInt.h:214</a></div></div>
<div class="ttc" id="astructllvm_1_1UnsignedDivisionByConstantInfo_html_a890b63a18fc3e328809c691b17c776ed"><div class="ttname"><a href="structllvm_1_1UnsignedDivisionByConstantInfo.html#a890b63a18fc3e328809c691b17c776ed">llvm::UnsignedDivisionByConstantInfo::Magic</a></div><div class="ttdeci">APInt Magic</div><div class="ttdoc">magic number</div><div class="ttdef"><b>Definition:</b> <a href="DivisionByConstantInfo_8h_source.html#l00031">DivisionByConstantInfo.h:31</a></div></div>
<div class="ttc" id="astructllvm_1_1SignedDivisionByConstantInfo_html_a4cfbfc736687e2b99cd2cc6cd2d208c4"><div class="ttname"><a href="structllvm_1_1SignedDivisionByConstantInfo.html#a4cfbfc736687e2b99cd2cc6cd2d208c4">llvm::SignedDivisionByConstantInfo::ShiftAmount</a></div><div class="ttdeci">unsigned ShiftAmount</div><div class="ttdoc">shift amount</div><div class="ttdef"><b>Definition:</b> <a href="DivisionByConstantInfo_8h_source.html#l00024">DivisionByConstantInfo.h:24</a></div></div>
<div class="ttc" id="aBuiltinGCs_8cpp_html_a9bf617fd3367180fb96cebccfaae8dfa"><div class="ttname"><a href="BuiltinGCs_8cpp.html#a9bf617fd3367180fb96cebccfaae8dfa">D</a></div><div class="ttdeci">static GCRegistry::Add&lt; StatepointGC &gt; D(&quot;statepoint-example&quot;, &quot;an example strategy for statepoint&quot;)</div></div>
<div class="ttc" id="astructllvm_1_1SignedDivisionByConstantInfo_html_affa10b6ac03585fea6d8f1832071ebd5"><div class="ttname"><a href="structllvm_1_1SignedDivisionByConstantInfo.html#affa10b6ac03585fea6d8f1832071ebd5">llvm::SignedDivisionByConstantInfo::get</a></div><div class="ttdeci">static SignedDivisionByConstantInfo get(const APInt &amp;D)</div><div class="ttdoc">Calculate the magic numbers required to implement a signed integer division by a constant as a sequen...</div><div class="ttdef"><b>Definition:</b> <a href="DivisionByConstantInfo_8cpp_source.html#l00021">DivisionByConstantInfo.cpp:21</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html"><div class="ttname"><a href="classllvm_1_1APInt.html">llvm::APInt</a></div><div class="ttdoc">Class for arbitrary precision integers.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00075">APInt.h:75</a></div></div>
<div class="ttc" id="astructllvm_1_1UnsignedDivisionByConstantInfo_html_a1b8b2eee90075caf0407679fb780f5c9"><div class="ttname"><a href="structllvm_1_1UnsignedDivisionByConstantInfo.html#a1b8b2eee90075caf0407679fb780f5c9">llvm::UnsignedDivisionByConstantInfo::IsAdd</a></div><div class="ttdeci">bool IsAdd</div><div class="ttdoc">add indicator</div><div class="ttdef"><b>Definition:</b> <a href="DivisionByConstantInfo_8h_source.html#l00032">DivisionByConstantInfo.h:32</a></div></div>
<div class="ttc" id="astructllvm_1_1UnsignedDivisionByConstantInfo_html"><div class="ttname"><a href="structllvm_1_1UnsignedDivisionByConstantInfo.html">llvm::UnsignedDivisionByConstantInfo</a></div><div class="ttdoc">Magic data for optimising unsigned division by a constant.</div><div class="ttdef"><b>Definition:</b> <a href="DivisionByConstantInfo_8h_source.html#l00028">DivisionByConstantInfo.h:28</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_a545e8d5dfa1688acea0d0e275b03682f"><div class="ttname"><a href="classllvm_1_1APInt.html#a545e8d5dfa1688acea0d0e275b03682f">llvm::APInt::ult</a></div><div class="ttdeci">bool ult(const APInt &amp;RHS) const</div><div class="ttdoc">Unsigned less than comparison.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l01061">APInt.h:1061</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_a05d674becc60ba4ef8cd4dd4d38ac27a"><div class="ttname"><a href="classllvm_1_1APInt.html#a05d674becc60ba4ef8cd4dd4d38ac27a">llvm::APInt::udiv</a></div><div class="ttdeci">APInt udiv(const APInt &amp;RHS) const</div><div class="ttdoc">Unsigned division operation.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8cpp_source.html#l01571">APInt.cpp:1571</a></div></div>
<div class="ttc" id="aregutils_8h_html_a1fa2460e32327ade49189c95740bc1b5"><div class="ttname"><a href="regutils_8h.html#a1fa2460e32327ade49189c95740bc1b5">NC</a></div><div class="ttdeci">#define NC</div><div class="ttdef"><b>Definition:</b> <a href="regutils_8h_source.html#l00042">regutils.h:42</a></div></div>
<div class="ttc" id="aclassllvm_1_1APInt_html_a8f877403433892e14ff0c692cbe9efdf"><div class="ttname"><a href="classllvm_1_1APInt.html#a8f877403433892e14ff0c692cbe9efdf">llvm::APInt::getSignedMinValue</a></div><div class="ttdeci">static APInt getSignedMinValue(unsigned numBits)</div><div class="ttdoc">Gets minimum signed value of APInt for a specific bit width.</div><div class="ttdef"><b>Definition:</b> <a href="APInt_8h_source.html#l00199">APInt.h:199</a></div></div>
<div class="ttc" id="astructllvm_1_1SignedDivisionByConstantInfo_html_aa54b0543973a6ef974f769d0e9383850"><div class="ttname"><a href="structllvm_1_1SignedDivisionByConstantInfo.html#aa54b0543973a6ef974f769d0e9383850">llvm::SignedDivisionByConstantInfo::Magic</a></div><div class="ttdeci">APInt Magic</div><div class="ttdoc">magic number</div><div class="ttdef"><b>Definition:</b> <a href="DivisionByConstantInfo_8h_source.html#l00023">DivisionByConstantInfo.h:23</a></div></div>
<div class="ttc" id="astructllvm_1_1SignedDivisionByConstantInfo_html"><div class="ttname"><a href="structllvm_1_1SignedDivisionByConstantInfo.html">llvm::SignedDivisionByConstantInfo</a></div><div class="ttdoc">Magic data for optimising signed division by a constant.</div><div class="ttdef"><b>Definition:</b> <a href="DivisionByConstantInfo_8h_source.html#l00021">DivisionByConstantInfo.h:21</a></div></div>
<div class="ttc" id="astructllvm_1_1UnsignedDivisionByConstantInfo_html_a505f562e64f576e9801f0549e190622a"><div class="ttname"><a href="structllvm_1_1UnsignedDivisionByConstantInfo.html#a505f562e64f576e9801f0549e190622a">llvm::UnsignedDivisionByConstantInfo::ShiftAmount</a></div><div class="ttdeci">unsigned ShiftAmount</div><div class="ttdoc">shift amount</div><div class="ttdef"><b>Definition:</b> <a href="DivisionByConstantInfo_8h_source.html#l00033">DivisionByConstantInfo.h:33</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Sep 20 2022 07:34:23 for LLVM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
