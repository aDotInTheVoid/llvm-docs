<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLVM: lib/Target/AMDGPU/SIWholeQuadMode.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LLVM
   &#160;<span id="projectnumber">12.0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_97aefd0d527b934f1d99a682da8fe6a9.html">lib</a></li><li class="navelem"><a class="el" href="dir_794e483eb1cc7921d35fd149d9cc325b.html">Target</a></li><li class="navelem"><a class="el" href="dir_447ce995d6e35417de5ec3060e97c93e.html">AMDGPU</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">SIWholeQuadMode.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This pass adds instructions to enable whole quad mode for pixel shaders, and whole wavefront mode for all programs.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="AMDGPU_8h_source.html">AMDGPU.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="GCNSubtarget_8h_source.html">GCNSubtarget.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="AMDGPUMCTargetDesc_8h_source.html">MCTargetDesc/AMDGPUMCTargetDesc.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="MapVector_8h_source.html">llvm/ADT/MapVector.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="PostOrderIterator_8h_source.html">llvm/ADT/PostOrderIterator.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="LiveIntervals_8h_source.html">llvm/CodeGen/LiveIntervals.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="MachineBasicBlock_8h_source.html">llvm/CodeGen/MachineBasicBlock.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="MachineFunctionPass_8h_source.html">llvm/CodeGen/MachineFunctionPass.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="MachineInstr_8h_source.html">llvm/CodeGen/MachineInstr.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="CallingConv_8h_source.html">llvm/IR/CallingConv.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="InitializePasses_8h_source.html">llvm/InitializePasses.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="raw__ostream_8h_source.html">llvm/Support/raw_ostream.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for SIWholeQuadMode.cpp:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="SIWholeQuadMode_8cpp__incl.svg" width="5802" height="768"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</div>
<p><a href="SIWholeQuadMode_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ad78e062f62e0d6e453941fb4ca843e4d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="SIWholeQuadMode_8cpp.html#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG_TYPE</a>&#160;&#160;&#160;&quot;si-wqm&quot;</td></tr>
<tr class="separator:ad78e062f62e0d6e453941fb4ca843e4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a320bfee867eaf92bf11ea43d449609e5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="SIWholeQuadMode_8cpp.html#a320bfee867eaf92bf11ea43d449609e5">INITIALIZE_PASS_BEGIN</a> (SIWholeQuadMode, <a class="el" href="LoadStoreVectorizer_8cpp.html#a030569d5a541b6110f2ae1b6a3413a58">DEBUG_TYPE</a>, &quot;SI Whole Quad <a class="el" href="SIWholeQuadMode_8cpp.html#a0c198437833c48138f49e3589bd08773">Mode</a>&quot;, false, <a class="el" href="VectorCombine_8cpp.html#a5a5a8a9d8745dc5abc3da0fe95f1ead4">false</a>) <a class="el" href="RegBankSelect_8cpp.html#a0eee13989797c0d4612066f84ff7a7b8">INITIALIZE_PASS_END</a>(SIWholeQuadMode</td></tr>
<tr class="separator:a320bfee867eaf92bf11ea43d449609e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a030569d5a541b6110f2ae1b6a3413a58"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="SIWholeQuadMode_8cpp.html#a030569d5a541b6110f2ae1b6a3413a58">DEBUG_TYPE</a></td></tr>
<tr class="separator:a030569d5a541b6110f2ae1b6a3413a58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c198437833c48138f49e3589bd08773"><td class="memItemLeft" align="right" valign="top"><a class="el" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> Whole Quad&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="SIWholeQuadMode_8cpp.html#a0c198437833c48138f49e3589bd08773">Mode</a></td></tr>
<tr class="separator:a0c198437833c48138f49e3589bd08773"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a310b00b81884fd84664936c3474e1556"><td class="memItemLeft" align="right" valign="top"><a class="el" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> Whole Quad&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="SIWholeQuadMode_8cpp.html#a310b00b81884fd84664936c3474e1556">false</a></td></tr>
<tr class="separator:a310b00b81884fd84664936c3474e1556"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This pass adds instructions to enable whole quad mode for pixel shaders, and whole wavefront mode for all programs. </p>
<p>Whole quad mode is required for derivative computations, but it interferes with shader side effects (stores and atomics). This pass is run on the scheduled machine IR but before register coalescing, so that machine SSA is available for analysis. It ensures that WQM is enabled when necessary, but disabled around stores and atomics.</p>
<p>When necessary, this pass creates a function prolog</p>
<p>S_MOV_B64 LiveMask, EXEC S_WQM_B64 EXEC, EXEC</p>
<p>to enter WQM at the top of the function and surrounds blocks of Exact instructions by</p>
<p>S_AND_SAVEEXEC_B64 Tmp, LiveMask ... S_MOV_B64 EXEC, Tmp</p>
<p>We also compute when a sequence of instructions requires Whole Wavefront Mode (WWM) and insert instructions to save and restore it:</p>
<p>S_OR_SAVEEXEC_B64 Tmp, -1 ... S_MOV_B64 EXEC, Tmp</p>
<p>In order to avoid excessive switching during sequences of Exact instructions, the pass first analyzes which instructions must be run in WQM (aka which instructions produce values that lead to derivative computations).</p>
<p>Basic blocks are always exited in WQM as long as some successor needs WQM.</p>
<p>There is room for improvement given better control flow analysis:</p>
<p>(1) at the top level (outside of control flow statements, and as long as kill hasn't been used), one SGPR can be saved by recovering WQM from the LiveMask (this is implemented for the entry block).</p>
<p>(2) when entire regions (e.g. if-else blocks or entire loops) only consist of exact and don't-care instructions, the switch only has to be done at the entry and exit points rather than potentially in each block of the region. </p>

<p class="definition">Definition in file <a class="el" href="SIWholeQuadMode_8cpp_source.html">SIWholeQuadMode.cpp</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ad78e062f62e0d6e453941fb4ca843e4d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad78e062f62e0d6e453941fb4ca843e4d">&#9670;&nbsp;</a></span>DEBUG_TYPE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEBUG_TYPE&#160;&#160;&#160;&quot;si-wqm&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="SIWholeQuadMode_8cpp_source.html#l00073">73</a> of file <a class="el" href="SIWholeQuadMode_8cpp_source.html">SIWholeQuadMode.cpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a320bfee867eaf92bf11ea43d449609e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a320bfee867eaf92bf11ea43d449609e5">&#9670;&nbsp;</a></span>INITIALIZE_PASS_BEGIN()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">INITIALIZE_PASS_BEGIN </td>
          <td>(</td>
          <td class="paramtype">SIWholeQuadMode&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="LoadStoreVectorizer_8cpp.html#a030569d5a541b6110f2ae1b6a3413a58">DEBUG_TYPE</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;SI Whole Quad <a class="el" href="SIWholeQuadMode_8cpp.html#a0c198437833c48138f49e3589bd08773">Mode</a>&quot;&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="VectorCombine_8cpp.html#a5a5a8a9d8745dc5abc3da0fe95f1ead4">false</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="VectorCombine_8cpp.html#a5a5a8a9d8745dc5abc3da0fe95f1ead4">false</a>&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a030569d5a541b6110f2ae1b6a3413a58"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a030569d5a541b6110f2ae1b6a3413a58">&#9670;&nbsp;</a></span>DEBUG_TYPE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">DEBUG_TYPE</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="SIWholeQuadMode_8cpp_source.html#l00208">208</a> of file <a class="el" href="SIWholeQuadMode_8cpp_source.html">SIWholeQuadMode.cpp</a>.</p>

</div>
</div>
<a id="a310b00b81884fd84664936c3474e1556"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a310b00b81884fd84664936c3474e1556">&#9670;&nbsp;</a></span>false</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> Whole Quad false</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="SIWholeQuadMode_8cpp_source.html#l00208">208</a> of file <a class="el" href="SIWholeQuadMode_8cpp_source.html">SIWholeQuadMode.cpp</a>.</p>

</div>
</div>
<a id="a0c198437833c48138f49e3589bd08773"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0c198437833c48138f49e3589bd08773">&#9670;&nbsp;</a></span>Mode</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="SIInstrInfo_8cpp.html#a0dfd55eaf0bcb495f09ecf8c55b256b2a6cbe5ff42f143903e1c67abf94613791">SI</a> Whole Quad Mode</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="SIWholeQuadMode_8cpp_source.html#l00208">208</a> of file <a class="el" href="SIWholeQuadMode_8cpp_source.html">SIWholeQuadMode.cpp</a>.</p>

<p class="reference">Referenced by <a class="el" href="AliasAnalysis_8h_source.html#l00751">llvm::AAResults::canInstructionRangeModRef()</a>, <a class="el" href="X86ISelLowering_8cpp_source.html#l42412">canReduceVMulWidth()</a>, <a class="el" href="Path_8cpp_source.html#l01278">llvm::sys::fs::TempFile::create()</a>, <a class="el" href="FileOutputBuffer_8cpp_source.html#l00166">llvm::FileOutputBuffer::create()</a>, <a class="el" href="FileOutputBuffer_8cpp_source.html#l00118">createInMemoryBuffer()</a>, <a class="el" href="FileOutputBuffer_8cpp_source.html#l00128">createOnDiskBuffer()</a>, <a class="el" href="RemarkSerializer_8cpp_source.html#l00021">llvm::remarks::createRemarkSerializer()</a>, <a class="el" href="Path_8cpp_source.html#l00168">createUniqueEntity()</a>, <a class="el" href="Path_8cpp_source.html#l00817">llvm::sys::fs::createUniqueFile()</a>, <a class="el" href="SIModeRegister_8cpp_source.html#l00061">Status::delta()</a>, <a class="el" href="FloatingPointMode_8h_source.html#l00160">llvm::denormalModeKindName()</a>, <a class="el" href="PPCISelLowering_8cpp_source.html#l11383">llvm::PPCTargetLowering::EmitInstrWithCustomInserter()</a>, <a class="el" href="X86ISelLowering_8cpp_source.html#l09334">ExpandHorizontalBinOp()</a>, <a class="el" href="AMDGPUTargetTransformInfo_8cpp_source.html#l00280">llvm::GCNTTIImpl::GCNTTIImpl()</a>, <a class="el" href="ARMAddressingModes_8h_source.html#l00471">llvm::ARM_AM::getAM4SubMode()</a>, <a class="el" href="ARMAddressingModes_8h_source.html#l00074">llvm::ARM_AM::getAMSubModeStr()</a>, <a class="el" href="AMDGPUBaseInfo_8h_source.html#l00885">llvm::AMDGPU::SIModeRegisterDefaults::getDefaultForCallingConv()</a>, <a class="el" href="AMDGPUAsmPrinter_8cpp_source.html#l00078">getFPMode()</a>, <a class="el" href="ARMLoadStoreOptimizer_8cpp_source.html#l00254">getLoadStoreMultipleOpcode()</a>, <a class="el" href="ARMLoadStoreOptimizer_8cpp_source.html#l01371">getPostIndexedLoadStoreOpcode()</a>, <a class="el" href="ARMLoadStoreOptimizer_8cpp_source.html#l01346">getPreIndexedLoadStoreOpcode()</a>, <a class="el" href="SIISelLowering_8cpp_source.html#l08266">getSPDenormModeValue()</a>, <a class="el" href="TargetLowering_8cpp_source.html#l05880">llvm::TargetLowering::getSqrtInputTest()</a>, <a class="el" href="ARMLoadStoreOptimizer_8cpp_source.html#l01118">getUpdatingLSMultipleOpcode()</a>, <a class="el" href="SystemZISelLowering_8cpp_source.html#l02716">getVectorComparison()</a>, <a class="el" href="SystemZISelLowering_8cpp_source.html#l02765">getVectorComparisonOrInvert()</a>, <a class="el" href="SIModeRegister_8cpp_source.html#l00054">Status::intersect()</a>, <a class="el" href="SIModeRegister_8cpp_source.html#l00071">Status::isCompatible()</a>, <a class="el" href="TargetTransformInfo_8cpp_source.html#l01004">llvm::TargetTransformInfo::isIndexedLoadLegal()</a>, <a class="el" href="TargetTransformInfo_8cpp_source.html#l01009">llvm::TargetTransformInfo::isIndexedStoreLegal()</a>, <a class="el" href="TypeIndexDiscovery_8cpp_source.html#l00034">isMemberPointer()</a>, <a class="el" href="RISCVBaseInfo_8h_source.html#l00177">llvm::RISCVFPRndMode::isValidRoundingMode()</a>, <a class="el" href="AMDGPULegalizerInfo_8cpp_source.html#l03194">llvm::AMDGPULegalizerInfo::legalizeFDIV32()</a>, <a class="el" href="IR_2Core_8cpp_source.html#l02226">LLVMSetThreadLocalMode()</a>, <a class="el" href="SIMachineFunctionInfo_8h_source.html#l00259">llvm::yaml::MappingTraits&lt; SIMode &gt;::mapping()</a>, <a class="el" href="X86ISelLowering_8cpp_source.html#l48766">matchPMADDWD()</a>, <a class="el" href="SIModeRegister_8cpp_source.html#l00042">Status::merge()</a>, <a class="el" href="SIModeRegister_8cpp_source.html#l00048">Status::mergeUnknown()</a>, <a class="el" href="FileSystem_8h_source.html#l01053">llvm::sys::fs::openFileForReadWrite()</a>, <a class="el" href="FileSystem_8h_source.html#l01012">llvm::sys::fs::openFileForWrite()</a>, <a class="el" href="FileSystem_8h_source.html#l01073">llvm::sys::fs::openNativeFileForReadWrite()</a>, <a class="el" href="FileSystem_8h_source.html#l01031">llvm::sys::fs::openNativeFileForWrite()</a>, <a class="el" href="FloatingPointMode_8h_source.html#l00142">llvm::operator&lt;&lt;()</a>, <a class="el" href="SIModeRegister_8cpp_source.html#l00065">Status::operator==()</a>, <a class="el" href="FloatingPointMode_8h_source.html#l00174">llvm::parseDenormalFPAttribute()</a>, <a class="el" href="SourceMgr_8cpp_source.html#l00473">llvm::SMDiagnostic::print()</a>, <a class="el" href="X86AsmPrinter_8cpp_source.html#l00407">printAsmMRegister()</a>, <a class="el" href="X86AsmPrinter_8cpp_source.html#l00449">printAsmVRegister()</a>, <a class="el" href="ARMInstPrinter_8cpp_source.html#l00641">llvm::ARMInstPrinter::printLdStmModeOperand()</a>, <a class="el" href="X86ISelLowering_8cpp_source.html#l42474">reduceVMULWidth()</a>, <a class="el" href="TargetOptions_8h_source.html#l00392">llvm::TargetOptions::setFP32DenormalMode()</a>, <a class="el" href="TargetOptions_8h_source.html#l00388">llvm::TargetOptions::setFPDenormalMode()</a>, <a class="el" href="llvm_2Target_2TargetMachine_8h_source.html#l00244">llvm::TargetMachine::setGlobalISelAbort()</a>, <a class="el" href="SIMachineFunctionInfo_8h_source.html#l00239">llvm::yaml::SIMode::SIMode()</a>, <a class="el" href="NVPTXTargetTransformInfo_8cpp_source.html#l00115">simplifyNvvmIntrinsic()</a>, <a class="el" href="SIModeRegister_8cpp_source.html#l00036">Status::Status()</a>, <a class="el" href="AMDGPULegalizerInfo_8cpp_source.html#l03166">toggleSPDenormMode()</a>, <a class="el" href="InlineAdvisor_8cpp_source.html#l00156">llvm::InlineAdvisorAnalysis::Result::tryCreate()</a>, and <a class="el" href="MachOUniversalWriter_8cpp_source.html#l00307">llvm::object::writeUniversalBinary()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Jul 9 2021 06:04:02 for LLVM by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
